
import React, { useState, useCallback, useMemo } from 'react';
import { TerminalInput } from './components/TerminalInput';
import { ResultCard } from './components/ResultCard';
import { database } from './services/database';
import { DatabaseEntry, SearchState } from './types';

const App: React.FC = () => {
  const [search, setSearch] = useState<SearchState>({
    itemName: '',
    questName: ''
  });
  const [results, setResults] = useState<DatabaseEntry[]>([]);
  const [isSearching, setIsSearching] = useState(false);
  const [hasSearched, setHasSearched] = useState(false);

  const handleSearch = useCallback(() => {
    setIsSearching(true);
    setHasSearched(false);
    
    // Simulate system processing delay
    setTimeout(() => {
      const queryItem = search.itemName.toLowerCase().trim();
      const queryQuest = search.questName.toLowerCase().trim();

      const filtered = database.filter(entry => {
        if (queryItem && entry.type === 'item') {
          return entry.name.toLowerCase().includes(queryItem);
        }
        if (queryQuest && entry.type === 'quest') {
          return entry.name.toLowerCase().includes(queryQuest);
        }
        return false;
      });

      setResults(filtered);
      setIsSearching(false);
      setHasSearched(true);
    }, 800);
  }, [search]);

  const resetSearch = () => {
    setSearch({ itemName: '', questName: '' });
    setResults([]);
    setHasSearched(false);
  };

  return (
    <div className="min-h-screen p-4 md:p-10 flex flex-col max-w-4xl mx-auto">
      {/* Header */}
      <header className="mb-12 border-b-2 border-[#FF5F1F] pb-4 relative">
        <h1 className="text-4xl md:text-6xl font-black text-[#FF5F1F] glow-text leading-tight">
          COMPAGNON ARC RAIDERS
        </h1>
        <div className="flex justify-between items-end mt-2">
          <span className="text-xs text-[#E5E4E2]/60">INTERFACE ANALYTIQUE V3.1.2</span>
          <span className="text-xs text-[#FF5F1F] animate-pulse">SYSTEM_ONLINE</span>
        </div>
      </header>

      {/* Input Section */}
      <section className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
        <div className="bg-[#1a1a1a]/40 p-6 border border-[#FF5F1F]/30 glow-border">
          <TerminalInput 
            label="RECHERCHE D'OBJET" 
            placeholder="EX: NOYAU DE DRONE..." 
            value={search.itemName}
            onChange={(val) => setSearch(prev => ({ ...prev, itemName: val, questName: '' }))}
            onEnter={handleSearch}
          />
        </div>
        <div className="bg-[#1a1a1a]/40 p-6 border border-[#FF5F1F]/30 glow-border">
          <TerminalInput 
            label="RECHERCHE DE QUÊTE" 
            placeholder="EX: EXTRACTION VIP..." 
            value={search.questName}
            onChange={(val) => setSearch(prev => ({ ...prev, questName: val, itemName: '' }))}
            onEnter={handleSearch}
          />
        </div>
      </section>

      {/* Action Bar */}
      <div className="flex flex-col md:flex-row gap-4 mb-12">
        <button 
          onClick={handleSearch}
          disabled={isSearching || (!search.itemName && !search.questName)}
          className={`flex-1 py-4 text-2xl font-bold transition-all border-2 
            ${isSearching || (!search.itemName && !search.questName) 
              ? 'border-[#FF5F1F]/20 text-[#FF5F1F]/20 cursor-not-allowed' 
              : 'border-[#FF5F1F] text-[#FF5F1F] hover:bg-[#FF5F1F] hover:text-[#0a0a0a] glow-border'
            }`}
        >
          {isSearching ? 'ANALYSE EN COURS...' : "LANCER L'ANALYSE"}
        </button>
        <button 
          onClick={resetSearch}
          className="px-8 py-4 border-2 border-[#E5E4E2]/20 text-[#E5E4E2]/40 hover:border-[#E5E4E2] hover:text-[#E5E4E2] transition-colors"
        >
          RÉINITIALISER
        </button>
      </div>

      {/* Results Section */}
      <main className="flex-1">
        <div className="mb-4 flex items-center gap-4">
          <div className="h-[2px] bg-[#FF5F1F]/30 flex-1"></div>
          <h2 className="text-[#FF5F1F] text-sm tracking-widest">FLUX DE DONNÉES</h2>
          <div className="h-[2px] bg-[#FF5F1F]/30 flex-1"></div>
        </div>

        {isSearching && (
          <div className="text-center py-20 space-y-4">
            <div className="text-4xl animate-bounce text-[#FF5F1F]">...</div>
            <p className="text-[#FF5F1F] tracking-widest animate-pulse">SYNCHRONISATION AVEC LES SATELLITES ARC</p>
          </div>
        )}

        {!isSearching && results.length > 0 && (
          <div className="space-y-6 animate-in fade-in duration-500">
            {results.map((entry) => (
              <ResultCard key={entry.id} entry={entry} />
            ))}
          </div>
        )}

        {!isSearching && hasSearched && results.length === 0 && (
          <div className="border-2 border-red-600 bg-red-900/20 p-10 text-center glow-border">
            <h3 className="text-3xl text-red-500 mb-2">SIGNAL PERDU</h3>
            <p className="text-red-400 opacity-80">AUCUNE DONNÉE CORRESPONDANTE DANS LA BASE LOCALE</p>
          </div>
        )}

        {!isSearching && !hasSearched && (
          <div className="text-center py-20 opacity-30">
            <p className="text-lg">ATTENTE DE COMMANDE RAIDER...</p>
            <p className="text-xs mt-2">ENTREZ UN NOM D'OBJET OU DE QUÊTE POUR COMMENCER LE SCAN</p>
          </div>
        )}
      </main>

      {/* Footer Decoration */}
      <footer className="mt-12 pt-6 border-t border-[#FF5F1F]/20 flex justify-between text-[10px] text-[#FF5F1F]/50">
        <span>ENCRYPTED_CONNECTION: AES-256</span>
        <span>ARC_REMNANT_PROTOCOL_ACTIVE</span>
        <span>© 1989 COMPAGNON_TECH</span>
      </footer>
    </div>
  );
};

export default App;
